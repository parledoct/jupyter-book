
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Using default parameters &#8212; Parledoct</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/parledoct.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Index" href="../../genindex.html" />
    <link rel="prev" title="Voice activity detection" href="00_index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Parledoct</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Background
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01_overview/00_index.html">
   Machine-assisted speech processing
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_overview/01_task-definitions.html">
     Tasks as multiple-choice questions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_overview/02_feats-and-class.html">
     Distill then decide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_overview/03_train-and-eval.html">
     Training as searching for optimal parameters
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02_environment/00_index.html">
   Computation environment
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_environment/01_saturncloud-account.html">
     Create SaturnCloud account
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_environment/02_saturncloud-launch.html">
     Resources on SaturnCloud
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_environment/03_jupyterlab-intro.html">
     JupyterLab Interface
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="00_index.html">
   Voice activity detection
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Using default parameters
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/chapters/03_voice-activity-detection/01_defaults.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-i-a-single-file">
   Part I: A single file
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-required-packages">
     Import required packages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#detect-speech-regions">
     Detect speech regions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#export-speech-regions-to-elan">
     Export speech regions to ELAN
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-and-configure-an-eaf-object">
       Create and configure an
       <code class="docutils literal notranslate">
        <span class="pre">
         Eaf
        </span>
       </code>
       object
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-detected-speech-regions-to-default-tier">
       Add detected speech regions to
       <code class="docutils literal notranslate">
        <span class="pre">
         default
        </span>
       </code>
       tier
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#write-data-to-an-eaf-file">
       Write data to an Eaf file
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-and-view-files">
     Download and view files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-ii-multiple-files-in-folder">
   Part II: Multiple files in folder
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prerequisites-file-paths-in-python">
     Prerequisites: File paths in Python
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#use-glob-glob-to-locate-files-of-interest">
       Use
       <code class="docutils literal notranslate">
        <span class="pre">
         glob.glob()
        </span>
       </code>
       to locate files of interest
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#manipulating-file-paths">
       Manipulating file paths
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#get-basename-from-full-path">
         Get basename from full path
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#create-full-path-for-eaf-file">
         Create full path for eaf file
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#final-script">
     Final script
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Download and view files
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Using default parameters</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-i-a-single-file">
   Part I: A single file
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-required-packages">
     Import required packages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#detect-speech-regions">
     Detect speech regions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#export-speech-regions-to-elan">
     Export speech regions to ELAN
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-and-configure-an-eaf-object">
       Create and configure an
       <code class="docutils literal notranslate">
        <span class="pre">
         Eaf
        </span>
       </code>
       object
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-detected-speech-regions-to-default-tier">
       Add detected speech regions to
       <code class="docutils literal notranslate">
        <span class="pre">
         default
        </span>
       </code>
       tier
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#write-data-to-an-eaf-file">
       Write data to an Eaf file
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-and-view-files">
     Download and view files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-ii-multiple-files-in-folder">
   Part II: Multiple files in folder
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prerequisites-file-paths-in-python">
     Prerequisites: File paths in Python
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#use-glob-glob-to-locate-files-of-interest">
       Use
       <code class="docutils literal notranslate">
        <span class="pre">
         glob.glob()
        </span>
       </code>
       to locate files of interest
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#manipulating-file-paths">
       Manipulating file paths
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#get-basename-from-full-path">
         Get basename from full path
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#create-full-path-for-eaf-file">
         Create full path for eaf file
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#final-script">
     Final script
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Download and view files
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="using-default-parameters">
<h1>Using default parameters<a class="headerlink" href="#using-default-parameters" title="Permalink to this headline">#</a></h1>
<p>As mentioned, we’ll use the <a class="reference external" href="https://github.com/amsehili/auditok">auditok</a> Python package, which provides an easy way to detect regions in a sound file that are above a certain threshold of acoustic energy (defaults to <code class="docutils literal notranslate"><span class="pre">50</span> <span class="pre">dB</span></code>).
We’ll then use the <a class="reference external" href="https://dopefishh.github.io/pympi/index.html">pympi</a> Python package to export the time regions to an ELAN file.</p>
<p>Because there’s ‘admin’ work when processing multiple files (e.g. getting the right file paths, deciding what to name the output file on-the-fly), we’ll focus on processing just a single file in Part I.
Then in Part II, we’ll learn to set up the ‘admin’ work and apply the process we learned about to multiple files.</p>
<section id="part-i-a-single-file">
<h2>Part I: A single file<a class="headerlink" href="#part-i-a-single-file" title="Permalink to this headline">#</a></h2>
<p>First let’s process just a single file to make sure each step of the process results in the output we’re expecting.</p>
<section id="import-required-packages">
<h3>Import required packages<a class="headerlink" href="#import-required-packages" title="Permalink to this headline">#</a></h3>
<p>Let’s start by importing the packages we’ll need:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">auditok</span>
<span class="kn">import</span> <span class="nn">pympi</span>
</pre></div>
</div>
</section>
<section id="detect-speech-regions">
<h3>Detect speech regions<a class="headerlink" href="#detect-speech-regions" title="Permalink to this headline">#</a></h3>
<p>Now that we have imported <code class="docutils literal notranslate"><span class="pre">auditok</span></code> into our computation environment, we can use <code class="docutils literal notranslate"><span class="pre">auditok.split()</span></code> to obtain a list of speech regions where the acoustic activity is above the default 50 dB threshold in the <code class="docutils literal notranslate"><span class="pre">data/20180518o.wav</span></code> file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">speech_regions</span> <span class="o">=</span> <span class="n">auditok</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;data/20180518o.wav&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="export-speech-regions-to-elan">
<h3>Export speech regions to ELAN<a class="headerlink" href="#export-speech-regions-to-elan" title="Permalink to this headline">#</a></h3>
<section id="create-and-configure-an-eaf-object">
<h4>Create and configure an <code class="docutils literal notranslate"><span class="pre">Eaf</span></code> object<a class="headerlink" href="#create-and-configure-an-eaf-object" title="Permalink to this headline">#</a></h4>
<p>We can now export these speech regions to an ELAN file.
First, we’ll create a new, empty <code class="docutils literal notranslate"><span class="pre">Eaf</span></code> object by specifying <code class="docutils literal notranslate"><span class="pre">file_path=None</span></code> (if you specify a real file path, it’ll load in the data from that file) and, for convenience, also add the wav file as a linked file so when we view the resulting <code class="docutils literal notranslate"><span class="pre">.eaf</span></code> file in ELAN later, the wav file will also be loaded in ELAN.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">annot_data</span> <span class="o">=</span> <span class="n">pympi</span><span class="o">.</span><span class="n">Elan</span><span class="o">.</span><span class="n">Eaf</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">annot_data</span><span class="o">.</span><span class="n">add_linked_file</span><span class="p">(</span><span class="s1">&#39;20180518o.wav&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="add-detected-speech-regions-to-default-tier">
<h4>Add detected speech regions to <code class="docutils literal notranslate"><span class="pre">default</span></code> tier<a class="headerlink" href="#add-detected-speech-regions-to-default-tier" title="Permalink to this headline">#</a></h4>
<p>We’ll loop through each detected region in <code class="docutils literal notranslate"><span class="pre">speech_regions</span></code> (which we just created using auditok) and add a blank annotation onto the <code class="docutils literal notranslate"><span class="pre">default</span></code> tier (automatically created by <code class="docutils literal notranslate"><span class="pre">pympi.Elan.Eaf</span></code>).
The only thing we have to do to make the time regions detected by auditok (specified in seconds) to be compatible is to convert the times into milliseconds (as expected by the <code class="docutils literal notranslate"><span class="pre">add_annotation</span></code> function).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">speech_regions</span><span class="p">:</span>
    <span class="c1"># auditok stores the start and end times (in seconds)</span>
    <span class="c1"># as the metadata of each detected region. Convert to</span>
    <span class="c1"># milliseconds to be compatible with the time format</span>
    <span class="c1"># the add_annotation function is expecting</span>

    <span class="n">start_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">start</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">end_ms</span>   <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">end</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># Add a blank annotation (value=&#39;&#39;) on the &#39;default&#39; tier</span>
    <span class="n">annot_data</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="n">id_tier</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start_ms</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_ms</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you’re new to Python, note that whitespace/indentation is semantically meaningful. Instead of curly braces <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> which you might have seen in other languages (e.g. in R: <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">(region</span> <span class="pre">in</span> <span class="pre">speech_regions)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>), Python uses whitespace to specify that <code class="docutils literal notranslate"><span class="pre">start_ms</span> <span class="pre">=</span> <span class="pre">...</span></code>, <code class="docutils literal notranslate"><span class="pre">end_ms</span> <span class="pre">=</span> <span class="pre">...</span></code> and <code class="docutils literal notranslate"><span class="pre">annot_data.add_annotation(...)</span></code> are within the loop.</p>
</div>
</section>
<section id="write-data-to-an-eaf-file">
<h4>Write data to an Eaf file<a class="headerlink" href="#write-data-to-an-eaf-file" title="Permalink to this headline">#</a></h4>
<p>Now we can export the data to an <code class="docutils literal notranslate"><span class="pre">eaf</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">annot_data</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;data/20180518o.eaf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="download-and-view-files">
<h3>Download and view files<a class="headerlink" href="#download-and-view-files" title="Permalink to this headline">#</a></h3>
<p>To make it easy to download multiple files from the SaturnCloud server, let’s zip up the <code class="docutils literal notranslate"><span class="pre">data/20180518o.eaf</span></code> we just created and the accompanying audio file <code class="docutils literal notranslate"><span class="pre">data/20180518o.wav</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!zip vad01_single-file.zip -j data/20180518o.wav data/20180518o.eaf
</pre></div>
</div>
<p>Once the <code class="docutils literal notranslate"><span class="pre">vad01_single-file.zip</span></code> file appears in the JupyterLab file browser on the left (you may need to hit the refresh button), right-click and download the file onto your computer. Unzip the files and open up <code class="docutils literal notranslate"><span class="pre">20180518o.eaf</span></code> in ELAN. As expected, you should be able to see on the <code class="docutils literal notranslate"><span class="pre">default</span></code> tier speech regions that <code class="docutils literal notranslate"><span class="pre">auditok</span></code> have detected as being above the 50 dB threshold:</p>
<figure class="align-default">
<img alt="../../_images/vad_elan-single-file.png" src="../../_images/vad_elan-single-file.png" />
</figure>
</section>
</section>
<section id="part-ii-multiple-files-in-folder">
<h2>Part II: Multiple files in folder<a class="headerlink" href="#part-ii-multiple-files-in-folder" title="Permalink to this headline">#</a></h2>
<p>Once we’re confident about a sequence of commands, we can have Python run those commands for each file we want to process.
But now that we want to abstract away from a set of commands that worked on a fixed file path (i.e. <code class="docutils literal notranslate"><span class="pre">data/20180518o.wav</span></code>) to ones that work on an arbitrary list of files, we’ll need to bring in some other packages to help handle these file paths.</p>
<section id="prerequisites-file-paths-in-python">
<h3>Prerequisites: File paths in Python<a class="headerlink" href="#prerequisites-file-paths-in-python" title="Permalink to this headline">#</a></h3>
<p>Let’s take a moment to go over and familiarise ourselves with common file path maniupation routines since getting data from files you want to process and modifying/creating files that contain the processed data is a fundamental part learning to process your own data (even when you can treat the main processing function as a blackbox).</p>
<section id="use-glob-glob-to-locate-files-of-interest">
<h4>Use <code class="docutils literal notranslate"><span class="pre">glob.glob()</span></code> to locate files of interest<a class="headerlink" href="#use-glob-glob-to-locate-files-of-interest" title="Permalink to this headline">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">glob</span></code> function from the <code class="docutils literal notranslate"><span class="pre">glob</span></code> package takes an expression and returns a list of file paths that matches that expression. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, import glob if not already present in environment</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="c1"># To see the output of each command, run each of them individually instead of</span>
<span class="c1"># copying and pasting the entire codeblock.</span>

<span class="c1"># List all files in current directory</span>
<span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>

<span class="c1"># List all files in data directory</span>
<span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/*&#39;</span><span class="p">)</span>

<span class="c1"># List all wav files in data directory</span>
<span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/*.wav&#39;</span><span class="p">)</span>

<span class="c1"># List all wav files in data directory ending with &#39;o&#39; or &#39;p&#39;</span>
<span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/*[o|p].wav&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this way, when you’re having to process a corpus with hundreds or thousands of files, you can use such expressions to target only the files you’re interested in processing. It’s <em>always</em> a good idea to at least eyeball the list of files returned, especially before running commands that modify or delete the files!</p>
</section>
<section id="manipulating-file-paths">
<h4>Manipulating file paths<a class="headerlink" href="#manipulating-file-paths" title="Permalink to this headline">#</a></h4>
<section id="get-basename-from-full-path">
<h5>Get basename from full path<a class="headerlink" href="#get-basename-from-full-path" title="Permalink to this headline">#</a></h5>
<p>To create and configure the Eaf files, we also need to derive additional file paths from the wav file’s ‘full’ path (e.g. <code class="docutils literal notranslate"><span class="pre">data/20180518o.wav</span></code>).</p>
<p>First, we need to extract only the wav file’s name (e.g. <code class="docutils literal notranslate"><span class="pre">20180518o.wav</span></code>) since linked files in Elan are expected to be relative paths (we don’t want the a relative path of <code class="docutils literal notranslate"><span class="pre">data/20180518o.wav</span></code> which implies that the wav file is in <code class="docutils literal notranslate"><span class="pre">data/data/20180518o.wav</span></code> for the Elan file in <code class="docutils literal notranslate"><span class="pre">data/20180518o.eaf</span></code>).
Across many programming languages, a file name without any path(s) prefixed to it is called the <em>basename</em>.
In Python, we can use the <code class="docutils literal notranslate"><span class="pre">basename</span></code> function located in the <code class="docutils literal notranslate"><span class="pre">os</span></code> package (under the path-related functions):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># From &#39;data/20180518o.wav&#39;, derive &#39;20180518o.wav&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="s1">&#39;data/20180518o.wav&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-full-path-for-eaf-file">
<h5>Create full path for eaf file<a class="headerlink" href="#create-full-path-for-eaf-file" title="Permalink to this headline">#</a></h5>
<p>Second, we need to create a ‘full’ path to the Eaf file we’ll be writing to (e.g. <code class="docutils literal notranslate"><span class="pre">data/20180518o.eaf</span></code>). So, we’ll use the <code class="docutils literal notranslate"><span class="pre">rsplit('.')</span></code> function to split the wav path <code class="docutils literal notranslate"><span class="pre">data/20180518o.wav</span></code> based on the first <code class="docutils literal notranslate"><span class="pre">.</span></code> from the right side, yielding a list of two items <code class="docutils literal notranslate"><span class="pre">['data/20180518o',</span> <span class="pre">'wav']</span></code>.
Then, we’ll take only the first element (<code class="docutils literal notranslate"><span class="pre">data/20180518o</span></code>) and postpend a new extension <code class="docutils literal notranslate"><span class="pre">.eaf</span></code> to get <code class="docutils literal notranslate"><span class="pre">data/20180518o.eaf</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;data/20180518o.wav&#39;</span>

<span class="c1"># Split &#39;data/20180518o.wav&#39; into &#39;data/20180518o&#39; and &#39;wav&#39;</span>
<span class="n">file_path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

<span class="c1"># From &#39;data/20180518o.wav&#39;, derive &#39;data/20180518o&#39;</span>
<span class="c1"># Note Python indexes from 0, so the first element is at position 0</span>
<span class="n">file_path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># From &#39;data/20180518o.wav&#39;, derive &#39;data/20180518o.eaf&#39;</span>
<span class="n">file_path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.eaf&#39;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="final-script">
<h3>Final script<a class="headerlink" href="#final-script" title="Permalink to this headline">#</a></h3>
<p>Based on Part I and what we’ve learned about file maniupation, you should be able to understand the gist of the following script, which will detect speech regions above 50 db and export these regions to accompany Eaf files for each wav file in the <code class="docutils literal notranslate"><span class="pre">data</span></code> folder.
Copy the code below (hover over the top-right corner of the codeblock then click the <code class="docutils literal notranslate"><span class="pre">copy</span></code>), paste it into your console, and execute it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import required packages</span>
<span class="kn">import</span> <span class="nn">auditok</span>
<span class="kn">import</span> <span class="nn">pympi</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Loop through each wav file in data folder</span>
<span class="k">for</span> <span class="n">wav_file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;data/*.wav&quot;</span><span class="p">):</span>

    <span class="c1"># Detect speech regions above 50 dB threshold</span>
    <span class="n">speech_regions</span> <span class="o">=</span> <span class="n">auditok</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">wav_file</span><span class="p">)</span>

    <span class="c1"># Create placeholder Eaf Object</span>
    <span class="n">annot_data</span> <span class="o">=</span> <span class="n">pympi</span><span class="o">.</span><span class="n">Elan</span><span class="o">.</span><span class="n">Eaf</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Add linked file</span>
    <span class="n">annot_data</span><span class="o">.</span><span class="n">add_linked_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">wav_file</span><span class="p">))</span>

    <span class="c1"># Loop through each detected region </span>
    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">speech_regions</span><span class="p">:</span>
        <span class="c1"># auditok stores the start and end times (in seconds)</span>
        <span class="c1"># as the metadata of each detected region. Convert to</span>
        <span class="c1"># milliseconds to be compatible with the time format</span>
        <span class="c1"># the add_annotation function is expecting</span>

        <span class="n">start_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">start</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">end_ms</span>   <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">end</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="c1"># Add a blank annotation (value=&#39;&#39;) on the &#39;default&#39; tier</span>
        <span class="n">annot_data</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span><span class="n">id_tier</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start_ms</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_ms</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Obtain output Eaf file path from wav file&#39;s path</span>
    <span class="c1"># e.g. &#39;data/20180518o.wav&#39; -&gt; &#39;data/20180518o.eaf&#39;</span>
    <span class="n">eaf_name</span> <span class="o">=</span> <span class="n">wav_file</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.eaf&#39;</span>

    <span class="c1"># Write Eaf data out to a file</span>
    <span class="n">annot_data</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">eaf_name</span><span class="p">)</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>When you’re developing your own scripts and are almost ready to process all your files, you may want to do some dry runs over a handful of files, for example, by taking just the first 2 items in the list of files returned by <code class="docutils literal notranslate"><span class="pre">glob.glob</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">wav_file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;data/*.wav&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]:</span>
</pre></div>
</div>
<p>In this way, you can gradually develop your script for just 1 file, then a handful of files, and only run it on all your files when you’re confident about it.</p>
</div>
</section>
<section id="id1">
<h3>Download and view files<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>Let’s zip up all wav and eaf files inside the <code class="docutils literal notranslate"><span class="pre">data</span></code> folder so you can download and view them on your computer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!zip vad02_multiple-files.zip -j data/*.wav data/*.eaf
</pre></div>
</div>
<p>Once the <code class="docutils literal notranslate"><span class="pre">vad02_multiple-files.zip</span></code> file appears in the JupyterLab file browser on the left (you may need to hit the refresh button), right-click and download the file onto your computer.</p>
<p>Congrats — you’ve completed your first speech processing task!</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters/03_voice-activity-detection"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="00_index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Voice activity detection</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../genindex.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Index</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By <a href="https://resunay.com">Nay San</a><br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>